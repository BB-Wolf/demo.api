# Модуль Demo API (demo.api)

Данный модуль предоставляет REST API для работы с каталогом товаров на базе Bitrix D7.

> [!NOTE]
> Это тестовое задание. В связи с этим некоторые данные (например, пути к изображениям и названия категорий в списках) могут быть упрощены или временно захардкожены, но архитектура модуля позволяет легко заменить их на динамические данные при необходимости.

## Особенности
- **Стандартизированные ответы**: Все API ответы возвращаются в едином формате `{status: "...", data: { ... }}`.
- **Пагинация**: Поддержка постраничной навигации в списке товаров.
- **Гибкая сортировка**: Возможность сортировки по ID, имени, цене и дате создания.
- **Кеширование**: Встроенное кеширование результатов запросов (TTL 300 секунд).
- **Расчет остатков**: Суммарный учет количества товара по всем доступным складам.
- **Bitrix D7 Routing**: Использование современных маршрутов Bitrix вместо `urlrewrite.php`.

## Установка

1. Скопируйте папку модуля в `/local/modules/demo.api`.
2. Перейдите в административную панель Bitrix: **Рабочий стол -> Настройки -> Настройки продукта -> Модули**.
3. Найдите модуль **"Demo API"** и нажмите **Установить**.
4. В процессе установки модуль автоматически зарегистрирует необходимые маршруты в `bitrix/.settings.php`.
5. В файле - demo.api/lib/classes/Controllers/ProductController.php в качестве фильтра принудительно задан IBLOCK_ID = 4. 
Это было сделано для тестового окружения, в реальном проекте IBLOCK_ID должен быть передан в запросе.

## API Endpoints

Все запросы выполняются по префиксу `/api/products` (в зависимости от настроек вашего сервера и маршрутизации).

### 1. Список товаров
`GET /api/products`

**Параметры (GET):**
- `category_id` (int) — ID категории для фильтрации.
- `limit` (int) — Количество товаров на страницу (по умолчанию 20).
- `page` (int) — Номер страницы (по умолчанию 1).
- `sort` (string) — Поле сортировки: `id`, `name`, `price`, `created`.
- `order` (string) — Направление: `asc` или `desc`.

### 2. Карточка товара по ID
`GET /api/products/id/{id}`

### 3. Карточка товара по XML_ID
`GET /api/products/xmlid/{xmlID}`

## Архитектура
- **Controllers**: Обработка входящих запросов и валидация параметров.
- **Services**: Бизнес-логика, подготовка данных и формирование финальных ответов.
- **Repositories**: Прямое взаимодействие с базой данных через Bitrix ORM (`ElementTable`, `StoreProductTable`).
- **Helpers**: Вспомогательные классы для формирования ответов и других общих задач.
